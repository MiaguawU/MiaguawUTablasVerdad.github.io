<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuitos</title>
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <div class="container">
        <h1>Circuitos</h1>
        
        <div class="arriba_cont">
            <div class="input-section">
            <div class="input-group">
                <label for="lista-numeros">Lista de números (separados por comas):</label>
                <textarea id="lista-numeros" placeholder="Ej: 5, 10, 15, 20, 8, 12"></textarea>
            </div>
            <button class="btn-generar" id="btn-generar">Analizar Lista</button>
        </div>
         <div class="tabla-container">
                <h3>Tabla</h3>
                <table id="tabla-resultados"></table>
            </div>
        </div>

        <div class="ecuacion-box">
            <h3>Funcion normal conjuntiva</h3>
            <p id="ecuacion"></p>
        </div>

        <div class="analysis-container">
           

            <div class="svg-container">
                <h3>Visualización de Datos</h3>
                <div id="canvas-container">
                    <svg id="logic-svg" width="1400" height="1200"></svg>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    import { dir_boolean } from "./app.js";
    const svg = document.getElementById("logic-svg");

    function renderizarTabla( tabla ){
      const table = document.getElementById("tabla-resultados");
      table.innerHTML = ""; 
      table.style.display = "table"; 

      // Crear <thead>
      const thead = document.createElement("thead");
      const trHead = document.createElement("tr");

      // Encabezados: el primer valor de cada columna
      for (let col = 0; col < tabla.length; col++) {
        const th = document.createElement("th");
        th.textContent = tabla[col][0]; 
        trHead.appendChild(th);
      }
      thead.appendChild(trHead);
      table.appendChild(thead);

      // Crear <tbody>
      const tbody = document.createElement("tbody");

      const numFilas = tabla[0].length - 1; // -1 porque el primero ya fue encabezado
      for (let fila = 0; fila < numFilas; fila++) {
        const tr = document.createElement("tr");
        tr.setAttribute("contenteditable", "true");

        for (let col = 0; col < tabla.length; col++) {
          const td = document.createElement("td");
          const val = tabla[col][fila + 1]; // +1 para saltar el encabezado
          td.textContent = val;
          td.classList.add(val)

          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }

      table.appendChild(tbody);
    }

    async function construirYMandar() {
      let resultado = document.getElementById("lista-numeros").value;
      const { tabla, funcion } = await dir_boolean(resultado,"logic-svg");

      renderizarTabla(tabla);
      document.getElementById('ecuacion').innerHTML = `F = ${funcion}`
      ajustarLienzo();
    }

    function ajustarLienzo() {
        
        const caja = svg.getBBox();
        
        const anchoFinal = caja.x + caja.width + 50;
        const altoFinal = caja.y + caja.height + 50;

        svg.setAttribute("width", anchoFinal);
        svg.setAttribute("height", altoFinal);
    }

    document.getElementById("btn-generar").addEventListener("click", () => construirYMandar());
  </script>
</body>
</html>